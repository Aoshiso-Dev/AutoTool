<UserControl x:Class="Panels.View.ListPanel"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vm="clr-namespace:Panels.ViewModel"
             xmlns:converter="clr-namespace:Panels.Converter"
             mc:Ignorable="d"
             d:DesignHeight="450" d:DesignWidth="1200">

    <UserControl.Resources>
        <converter:BooleanToTextConverter x:Key="BooleanToTextConverter" TrueText=">>" FalseText=""/>
        <converter:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>
        <converter:KeyToStringConverter x:Key="KeyToStringConverter" />
    </UserControl.Resources>

    <UserControl.DataContext>
        <vm:ListPanelViewModel/>
    </UserControl.DataContext>

    <Grid>
        <StackPanel>
            <!-- Buttons -->
            <StackPanel Orientation="Horizontal">
                <Button Content="{Binding RunButtonText}" Command="{Binding RunCommand}" Width="100" Margin="2" Foreground="White" Background="{Binding RunButtonColor}"/>
                <StackPanel>
                    <Button Content="Save" Command="{Binding SaveCommand}" Width="100" Margin="2"/>
                    <Button Content="Load" Command="{Binding LoadCommand}" Width="100" Margin="2"/>
                </StackPanel>
                <StackPanel>
                    <ComboBox ItemsSource="{Binding ItemTypes}" SelectedItem="{Binding SelectedItemType}" Width="100" Margin="2"/>
                    <Button Content="Add" Command="{Binding AddCommand}" Width="100" Margin="2"/>
                </StackPanel>
                <Button Content="Clear" Command="{Binding ClearCommand}" Width="100" Margin="2"/>
            </StackPanel>

            <!-- DataGrid -->
            <DataGrid ItemsSource="{Binding CommandList.Items, UpdateSourceTrigger=PropertyChanged}" SelectionMode="Single" HeadersVisibility="Column" CanUserAddRows="False" AutoGenerateColumns="False" EnableRowVirtualization="True" EnableColumnVirtualization="True">
                <DataGrid.Columns>
                    <!-- IsRunning -->
                    <DataGridTextColumn Header="" Width="30" Binding="{Binding IsRunning, Converter={StaticResource BooleanToTextConverter}}"/>

                    <!-- LineNumber -->
                    <DataGridTextColumn Header="" Width="30" Binding="{Binding LineNumber, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"/>

                    <!-- NestLevel -->
                    <DataGridTextColumn Header="" Width="30" Binding="{Binding NestLevel, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"/>
                    
                    <!-- Command -->
                    <DataGridTemplateColumn Header="Command" Width="150">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding ItemType, UpdateSourceTrigger=PropertyChanged}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Settings -->
                    <DataGridTemplateColumn Header="Settings" Width="600">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel>
                                    <!-- WaitImage -->
                                    <StackPanel Visibility="{Binding ItemType, Converter={StaticResource StringToVisibilityConverter}, ConverterParameter=WaitImage}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="Path:" Width="60" Margin="2"/>
                                            <TextBox Text="{Binding ImagePath, UpdateSourceTrigger=PropertyChanged}" Width="300" Margin="2"/>
                                            <Button Content="Browse"
                                                    Command="{Binding DataContext.BrowseCommand, RelativeSource={RelativeSource AncestorType={x:Type UserControl}}}"
                                                    CommandParameter="{Binding LineNumber}"
                                                    Margin="2"/>
                                            <Button Content="Capture"
                                                    Command="{Binding DataContext.CaptureCommand, RelativeSource={RelativeSource AncestorType={x:Type UserControl}}}"
                                                    CommandParameter="{Binding LineNumber}"
                                                    Margin="2"/>
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="Threshold:" Width="60" Margin="2"/>
                                            <TextBox Text="{Binding Threshold, UpdateSourceTrigger=PropertyChanged}" Width="80" Margin="2"/>
                                            <TextBlock Text="(0.1~1.0)" Margin="2"/>
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="Timeout:" Width="60" Margin="2"/>
                                            <TextBox Text="{Binding Timeout, UpdateSourceTrigger=PropertyChanged}" Width="80" Margin="2"/>
                                            <TextBlock Text="ms" Margin="2"/>
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="Interval:" Width="60" Margin="2"/>
                                            <TextBox Text="{Binding Interval, UpdateSourceTrigger=PropertyChanged}" Width="80" Margin="2"/>
                                            <TextBlock Text="ms" Margin="2"/>
                                        </StackPanel>
                                    </StackPanel>

                                    <!-- ClickImage -->
                                    <StackPanel Visibility="{Binding ItemType, Converter={StaticResource StringToVisibilityConverter}, ConverterParameter=ClickImage}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="Path:" Width="60" Margin="2"/>
                                            <TextBox Text="{Binding ImagePath, UpdateSourceTrigger=PropertyChanged}" Width="300" Margin="2"/>
                                            <Button Content="Browse" Command="{Binding DataContext.BrowseCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}" CommandParameter="{Binding LineNumber}" Margin="2"/>
                                            <Button Content="Capture" Command="{Binding DataContext.CaptureCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}" CommandParameter="{Binding LineNumber}" Margin="2"/>
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="Threshold:" Width="60" Margin="2"/>
                                            <TextBox Text="{Binding Threshold, UpdateSourceTrigger=PropertyChanged}" Width="80" Margin="2"/>
                                            <TextBlock Text="(0.1~1.0)" Margin="2"/>
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="Timeout:" Width="60" Margin="2"/>
                                            <TextBox Text="{Binding Timeout, UpdateSourceTrigger=PropertyChanged}" Width="80" Margin="2"/>
                                            <TextBlock Text="ms" Margin="2"/>
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="Interval:" Width="60" Margin="2"/>
                                            <TextBox Text="{Binding Interval, UpdateSourceTrigger=PropertyChanged}" Width="80" Margin="2"/>
                                            <TextBlock Text="ms" Margin="2"/>
                                        </StackPanel>
                                        <!--
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="Button:" Width="60" Margin="2"/>
                                            <ComboBox ItemsSource="{Binding Buttons}" SelectedItem="{Binding Button}" Width="80" Margin="2"/>
                                        </StackPanel>
                                        -->
                                    </StackPanel>

                                    <!-- Hotkey -->
                                    <StackPanel Visibility="{Binding ItemType, Converter={StaticResource StringToVisibilityConverter}, ConverterParameter=Hotkey}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="Ctrl:" Width="60" Margin="2"/>
                                            <CheckBox IsChecked="{Binding Ctrl, UpdateSourceTrigger=PropertyChanged}" Margin="2"/>
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="Shift:" Width="60" Margin="2"/>
                                            <CheckBox IsChecked="{Binding Shift, UpdateSourceTrigger=PropertyChanged}" Margin="2"/>
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="Alt:" Width="60" Margin="2"/>
                                            <CheckBox IsChecked="{Binding Alt, UpdateSourceTrigger=PropertyChanged}" Margin="2"/>
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="Key:" Width="60" Margin="2"/>
                                            <TextBox Text="{Binding Key, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource KeyToStringConverter}}" converter:KeyInputBehavior.Key="{Binding Key, Mode=TwoWay}" Width="50" Margin="2"/>
                                        </StackPanel>
                                    </StackPanel>
                                    
                                    <!-- Click -->
                                    <StackPanel Visibility="{Binding ItemType, Converter={StaticResource StringToVisibilityConverter}, ConverterParameter=Click}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="X:" Width="60" Margin="2"/>
                                            <TextBox Text="{Binding X, UpdateSourceTrigger=PropertyChanged}" Width="80" Margin="2"/>
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="Y:" Width="60" Margin="2"/>
                                            <TextBox Text="{Binding Y, UpdateSourceTrigger=PropertyChanged}" Width="80" Margin="2"/>
                                        </StackPanel>
                                        <!--
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="Button:" Width="60" Margin="2"/>
                                            <ComboBox ItemsSource="{Binding Buttons}" SelectedItem="{Binding Button}" Width="80" Margin="2"/>
                                        </StackPanel>
                                        -->
                                    </StackPanel>

                                    <!-- Wait -->
                                    <StackPanel Visibility="{Binding ItemType, Converter={StaticResource StringToVisibilityConverter}, ConverterParameter=Wait}">
                                        <TextBlock Text="WaitTime:" Width="60" Margin="2"/>
                                        <TextBox Text="{Binding Wait, UpdateSourceTrigger=PropertyChanged}" Width="80" Margin="2"/>
                                        <TextBlock Text="ms" Margin="2"/>
                                    </StackPanel>

                                    <!-- Loop -->
                                    <StackPanel Visibility="{Binding ItemType, Converter={StaticResource StringToVisibilityConverter}, ConverterParameter=Loop}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="LoopCount:" Width="60" Margin="2"/>
                                            <TextBox Text="{Binding LoopCount, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="80" Margin="2"/>
                                        </StackPanel>
                                    </StackPanel>
                                    
                                    <!-- If コマンドの設定 -->
                                    <StackPanel Visibility="{Binding ItemType, Converter={StaticResource StringToVisibilityConverter}, ConverterParameter=If}">
                                        <StackPanel Orientation="Horizontal">
                                            <ComboBox ItemsSource="{Binding ConditionTypes}" SelectedItem="{Binding ConditionType}"/>
                                            <!-- ImageExists -->
                                            <StackPanel Visibility="{Binding ConditionType, Converter={StaticResource StringToVisibilityConverter}, ConverterParameter=ImageExists}">
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="Path:" Width="60" Margin="2"/>
                                                    <TextBox Text="{Binding ImagePath, UpdateSourceTrigger=PropertyChanged}" Width="300" Margin="2"/>
                                                    <Button Content="Browse" Command="{Binding DataContext.BrowseCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}" CommandParameter="{Binding LineNumber}" Margin="2"/>
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="Timeout:" Width="60" Margin="2"/>
                                                    <TextBox Text="{Binding Timeout, UpdateSourceTrigger=PropertyChanged}" Width="80" Margin="2"/>
                                                    <TextBlock Text="ms" Margin="2"/>
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="WaitTime:" Width="60" Margin="2"/>
                                                    <TextBox Text="{Binding WaitTime, UpdateSourceTrigger=PropertyChanged}" Width="80" Margin="2"/>
                                                    <TextBlock Text="ms" Margin="2"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </StackPanel>
                                    </StackPanel>
                                    
                                </StackPanel>
                                
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Up / Dn -->
                    <DataGridTemplateColumn Header="" Width="100">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <Button Content="Up" Command="{Binding DataContext.UpCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}" CommandParameter="{Binding LineNumber}" Margin="2"/>
                                    <Button Content="Dn" Command="{Binding DataContext.DownCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}" CommandParameter="{Binding LineNumber}" Margin="2"/>
                                    <Button Content="Del" Command="{Binding DataContext.DeleteCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}" CommandParameter="{Binding LineNumber}" Margin="2"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </StackPanel>
    </Grid>
</UserControl>
