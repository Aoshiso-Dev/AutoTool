<UserControl x:Class="AutoTool.View.Panels.EditPanelView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
             xmlns:pg="http://schemas.xceed.com/wpf/xaml/toolkit">

    <!-- DataContext: VM などが SelectedCommand を持つ想定 -->
    <UserControl.Resources>

        <!-- 参照ボタンのスタイル -->
        <Style TargetType="Button" x:Key="BrowseButton">
            <Setter Property="Margin" Value="3,0,0,0"/>
            <Setter Property="Width" Value="40"/>
        </Style>
        
        <!-- テキストボックス1つのスタイル -->
        <Style TargetType="TextBox" x:Key="OneTextBox">
            <Setter Property="Width" Value="160"/>
        </Style>

        <!-- 画像ファイルのテンプレ（TextBox + 参照ボタン） -->
        <DataTemplate x:Key="FilePathEditorTemplate">
            <StackPanel Orientation="Horizontal">
                <TextBox Text="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource OneTextBox}"/>
                <Button Content="参照" Click="OnBrowseImagePath_Click" Style="{StaticResource BrowseButton}"/>
            </StackPanel>
        </DataTemplate>

        <!-- ONNXモデルのテンプレ -->
        <DataTemplate x:Key="OnnxPathEditorTemplate">
            <StackPanel Orientation="Horizontal">
                <TextBox Text="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource OneTextBox}"/>
                <Button Content="参照" Click="OnBrowseOnnxPath_Click" Style="{StaticResource BrowseButton}"/>
            </StackPanel>
        </DataTemplate>

        <!-- Point のテンプレ（X/Y + 取得ボタン） -->
        <DataTemplate x:Key="PointEditorTemplate">
            <StackPanel Orientation="Horizontal">
                <xctk:IntegerUpDown Width="80" Minimum="0" Maximum="20000"
                            Value="{Binding Value.X, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                <xctk:IntegerUpDown Width="80" Minimum="0" Maximum="20000"
                            Value="{Binding Value.Y, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                <Button Content="取得" Click="OnPickPoint_Click" Style="{StaticResource BrowseButton}"/>
            </StackPanel>
        </DataTemplate>

        <!-- ウィンドウタイトルのテンプレ（TextBox + 選択ボタン） -->
        <DataTemplate x:Key="WindowTitlePickerTemplate">
            <StackPanel Orientation="Horizontal">
                <TextBox Text="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource OneTextBox}"/>
                <Button Content="取得" Click="OnPickWindowTitle_Click" Style="{StaticResource BrowseButton}"/>
            </StackPanel>
        </DataTemplate>

        <!-- ウィンドウクラス名のテンプレ（TextBox + 選択ボタン） -->
        <DataTemplate x:Key="WindowClassNamePickerTemplate">
            <StackPanel Orientation="Horizontal">
                <TextBox Text="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource OneTextBox}"/>
                <Button Content="取得" Click="OnPickWindowClassName_Click" Style="{StaticResource BrowseButton}"/>
            </StackPanel>
        </DataTemplate>

        <!-- 0〜1 のスライダ用テンプレ -->
        <DataTemplate x:Key="Slider01Template">
            <StackPanel>
                <Slider Minimum="0" Maximum="1"
                Value="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                <TextBlock Foreground="Gray" FontSize="11"
                   Text="{Binding Value, StringFormat=0.00}"/>
            </StackPanel>
        </DataTemplate>

        <!-- 色選択（ColorPicker） -->
        <DataTemplate x:Key="ColorPickerTemplate">
            <xctk:ColorPicker UsingAlphaChannel="True"
                        SelectedColor="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
        </DataTemplate>

    </UserControl.Resources>

    <Grid>
        <xctk:PropertyGrid x:Name="Grid"
                       SelectedObject="{Binding SelectedCommand}"
                       AutoGenerateProperties="True"
                       IsCategorized="True"
                       NameColumnWidth="220"
                       ShowSearchBox="True">

            <!-- ★ プロパティ名でテンプレを割り当てる -->
            <xctk:PropertyGrid.EditorDefinitions>
                
                <!-- スライダ（複数プロパティ名をカンマ区切り） -->
                <pg:EditorTemplateDefinition TargetProperties="Threshold,ConfThreshold,IoUThreshold"
                                     EditingTemplate="{StaticResource Slider01Template}"/>

                <!-- ファイル/ONNX/座標/ウィンドウ/色 -->
                <pg:EditorTemplateDefinition TargetProperties="ImagePath"
                                     EditingTemplate="{StaticResource FilePathEditorTemplate}"/>
                <pg:EditorTemplateDefinition TargetProperties="ModelPath"
                                     EditingTemplate="{StaticResource OnnxPathEditorTemplate}"/>
                <pg:EditorTemplateDefinition TargetProperties="MousePosition"
                                     EditingTemplate="{StaticResource PointEditorTemplate}"/>
                <pg:EditorTemplateDefinition TargetProperties="WindowTitle"
                                     EditingTemplate="{StaticResource WindowTitlePickerTemplate}"/>
                <pg:EditorTemplateDefinition TargetProperties="WindowClassName"
                                     EditingTemplate="{StaticResource WindowClassNamePickerTemplate}"/>
                <pg:EditorTemplateDefinition TargetProperties="SearchColor"
                                     EditingTemplate="{StaticResource ColorPickerTemplate}"/>

            </xctk:PropertyGrid.EditorDefinitions>
        </xctk:PropertyGrid>
    </Grid>
</UserControl>
