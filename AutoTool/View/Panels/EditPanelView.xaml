<UserControl x:Class="AutoTool.View.Panels.EditPanelView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:local="clr-namespace:AutoTool.View.Panels"
             xmlns:converters="clr-namespace:AutoTool.View.Converters"
             mc:Ignorable="d">
    <UserControl.Resources>
        <converters:InvertBooleanConverter x:Key="InvertBooleanConverter" />
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <converters:MultiBoolToVisibilityConverter x:Key="MultiBoolToVisibilityConverter" />
    </UserControl.Resources>
    <!-- Edit Panel Content extracted from MainWindow -->
    <Grid IsEnabled="{Binding IsRunning, Converter={StaticResource InvertBooleanConverter}}" Background="White">
        <Border BorderBrush="LightGray" BorderThickness="1" Margin="5">
            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" 
                          Margin="10" Padding="5" Background="White">
                <StackPanel Background="White">
                    <!-- No items message -->
                    <StackPanel Visibility="{Binding IsListEmpty, Converter={StaticResource BoolToVisibilityConverter}}" 
                                Margin="0,20">
                        <TextBlock Text="リストにコマンドを追加してください" 
                                   FontSize="14" Foreground="DarkGray" TextWrapping="Wrap"/>
                        <TextBlock Text="上部の「追加」ボタンでコマンドを追加できます" 
                                   FontSize="11" Foreground="DarkGray" Margin="0,5,0,0" TextWrapping="Wrap"/>
                    </StackPanel>

                    <StackPanel Visibility="{Binding IsListNotEmptyButNoSelection, Converter={StaticResource BoolToVisibilityConverter}}" 
                                Margin="0,20">
                        <TextBlock Text="リストからコマンドを選択してください" 
                                   FontSize="14" Foreground="DarkGray" TextWrapping="Wrap"/>
                        <TextBlock Text="選択すると設定項目が表示されます" 
                                   FontSize="11" Foreground="DarkGray" Margin="0,5,0,0" TextWrapping="Wrap"/>
                    </StackPanel>

                    <!-- Settings (shown when item is selected) -->
                    <StackPanel Visibility="{Binding IsNotNullItem, Converter={StaticResource BoolToVisibilityConverter}}">
                        <!-- Command Type Selection -->
                        <StackPanel Orientation="Horizontal" Margin="0,5">
                            <TextBlock Text="コマンド:" Width="120" VerticalAlignment="Center" Foreground="Black"/>
                            <ComboBox ItemsSource="{Binding ItemTypes}" 
                                      SelectedItem="{Binding SelectedItemTypeObj}" 
                                      DisplayMemberPath="DisplayName"
                                      Width="200" Margin="5,0"
                                      Foreground="Black" Background="White"/>
                        </StackPanel>

                        <!-- Window Target Settings -->
                        <StackPanel Margin="0,5" Visibility="{Binding ShowWindowInfo, Converter={StaticResource BoolToVisibilityConverter}}">
                            <StackPanel Orientation="Horizontal" Margin="0,2">
                                <TextBlock Text="対象ウィンドウ:" Width="120" VerticalAlignment="Center" Foreground="Black"/>
                                <TextBox Text="{Binding WindowTitle, UpdateSourceTrigger=PropertyChanged}" Width="200" 
                                         Foreground="Black" Background="White"/>
                                <Button Content="取得" Command="{Binding GetWindowInfoCommand}" Margin="5,0,2,0" Width="40"
                                        Foreground="Black" Background="#F0F0F0"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,2">
                                <TextBlock Text="ウィンドウクラス:" Width="120" VerticalAlignment="Center" Foreground="Black"/>
                                <TextBox Text="{Binding WindowClassName, UpdateSourceTrigger=PropertyChanged}" Width="200"
                                         Foreground="Black" Background="White"/>
                                <Button Content="クリア" Command="{Binding ClearWindowInfoCommand}" Margin="5,0,2,0" Width="40"
                                        Foreground="Black" Background="#F0F0F0"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Image Path Settings -->
                        <StackPanel Orientation="Horizontal" Margin="0,5" 
                                    Visibility="{Binding IsImageBasedItem, Converter={StaticResource BoolToVisibilityConverter}}">
                            <TextBlock Text="画像パス:" Width="120" VerticalAlignment="Center" Foreground="Black"/>
                            <TextBox Text="{Binding ImagePath, UpdateSourceTrigger=PropertyChanged}" IsReadOnly="True" Width="150"
                                     Foreground="Black" Background="White"/>
                            <Button Content="参照" Command="{Binding BrowseImageFileCommand}" Margin="5,0,2,0" Width="40"
                                    Foreground="Black" Background="#F0F0F0"/>
                        </StackPanel>

                        <!-- Threshold Settings -->
                        <StackPanel Orientation="Horizontal" Margin="0,5"
                                    Visibility="{Binding IsImageBasedItem, Converter={StaticResource BoolToVisibilityConverter}}">
                            <TextBlock Text="しきい値:" Width="120" VerticalAlignment="Center" Foreground="Black"/>
                            <Slider Value="{Binding Threshold, UpdateSourceTrigger=PropertyChanged}" 
                                    Minimum="0.01" Maximum="1.00" SmallChange="0.01" LargeChange="0.1" 
                                    TickFrequency="0.01" IsSnapToTickEnabled="True" Width="120"/>
                            <TextBox Text="{Binding Threshold, StringFormat=F2}" IsReadOnly="True" Width="50" Margin="5,0"
                                     Foreground="Black" Background="White"/>
                        </StackPanel>

                        <!-- AI Model Settings -->
                        <StackPanel Margin="0,5" Visibility="{Binding IsAIBasedItem, Converter={StaticResource BoolToVisibilityConverter}}">
                            <StackPanel Orientation="Horizontal" Margin="0,2">
                                <TextBlock Text="ONNXモデル:" Width="120" VerticalAlignment="Center" Foreground="Black"/>
                                <TextBox Text="{Binding ModelPath, UpdateSourceTrigger=PropertyChanged}" IsReadOnly="True" Width="150"
                                         Foreground="Black" Background="White"/>
                                <Button Content="参照" Command="{Binding BrowseModelFileCommand}" Margin="5,0" Width="40"
                                        Foreground="Black" Background="#F0F0F0"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,2">
                                <TextBlock Text="クラスID:" Width="120" VerticalAlignment="Center" Foreground="Black"/>
                                <TextBox Text="{Binding ClassID, UpdateSourceTrigger=PropertyChanged}" Width="100"
                                         Foreground="Black" Background="White"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,2">
                                <TextBlock Text="信頼度閾値:" Width="120" VerticalAlignment="Center" Foreground="Black"/>
                                <Slider Value="{Binding ConfThreshold, UpdateSourceTrigger=PropertyChanged}" 
                                        Minimum="0.01" Maximum="1.00" SmallChange="0.01" LargeChange="0.1" 
                                        TickFrequency="0.01" IsSnapToTickEnabled="True" Width="100"/>
                                <TextBox Text="{Binding ConfThreshold, StringFormat=F2}" IsReadOnly="True" Width="50" Margin="5,0"
                                         Foreground="Black" Background="White"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,2">
                                <TextBlock Text="IoU閾値:" Width="120" VerticalAlignment="Center" Foreground="Black"/>
                                <Slider Value="{Binding IoUThreshold, UpdateSourceTrigger=PropertyChanged}" 
                                        Minimum="0.01" Maximum="1.00" SmallChange="0.01" LargeChange="0.1" 
                                        TickFrequency="0.01" IsSnapToTickEnabled="True" Width="100"/>
                                <TextBox Text="{Binding IoUThreshold, StringFormat=F2}" IsReadOnly="True" Width="50" Margin="5,0"
                                         Foreground="Black" Background="White"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Click Settings -->
                        <StackPanel Margin="0,5" Visibility="{Binding IsClickItem, Converter={StaticResource BoolToVisibilityConverter}}">
                            <StackPanel Orientation="Horizontal" Margin="0,2">
                                <TextBlock Text="X座標:" Width="120" VerticalAlignment="Center" Foreground="Black"/>
                                <TextBox Text="{Binding ClickX, UpdateSourceTrigger=PropertyChanged}" Width="80"
                                         Foreground="Black" Background="White"/>
                                <Button Content="取得" Command="{Binding GetMousePositionCommand}" Margin="5,0" Width="40"
                                        Foreground="Black" Background="#F0F0F0"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,2">
                                <TextBlock Text="Y座標:" Width="120" VerticalAlignment="Center" Foreground="Black"/>
                                <TextBox Text="{Binding ClickY, UpdateSourceTrigger=PropertyChanged}" Width="80"
                                         Foreground="Black" Background="White"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Mouse Button Settings -->
                        <StackPanel Orientation="Horizontal" Margin="0,5">
                            <TextBlock Text="ボタン:" Width="120" VerticalAlignment="Center" Foreground="Black"/>
                            <ComboBox ItemsSource="{Binding MouseButtons}" 
                                      SelectedItem="{Binding MouseButton}" Width="120"
                                      Foreground="Black" Background="White"/>
                            <StackPanel.Visibility>
                                <MultiBinding Converter="{StaticResource MultiBoolToVisibilityConverter}">
                                    <Binding Path="IsClickImageItem"/>
                                    <Binding Path="IsClickImageAIItem"/>
                                    <Binding Path="IsClickItem"/>
                                </MultiBinding>
                            </StackPanel.Visibility>
                        </StackPanel>

                        <!-- Background Click Settings -->
                        <StackPanel Margin="0,5">
                            <StackPanel Orientation="Horizontal" Margin="0,2">
                                <TextBlock Text="バックグラウンドクリック:" Width="120" VerticalAlignment="Center" Foreground="Black"/>
                                <CheckBox IsChecked="{Binding UseBackgroundClick, UpdateSourceTrigger=PropertyChanged}" 
                                          Foreground="Black"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,2">
                                <TextBlock Text="バックグラウンド方式:" Width="120" VerticalAlignment="Center" Foreground="Black"/>
                                <ComboBox ItemsSource="{Binding BackgroundClickMethods}" 
                                          SelectedValue="{Binding BackgroundClickMethod}" 
                                          SelectedValuePath="Value"
                                          DisplayMemberPath="DisplayName"
                                          Width="200" Margin="5,0"
                                          Foreground="Black" Background="White"
                                          IsEnabled="{Binding UseBackgroundClick}"/>
                            </StackPanel>
                            <StackPanel.Visibility>
                                <MultiBinding Converter="{StaticResource MultiBoolToVisibilityConverter}">
                                    <Binding Path="IsClickImageItem"/>
                                    <Binding Path="IsClickImageAIItem"/>
                                    <Binding Path="IsClickItem"/>
                                </MultiBinding>
                            </StackPanel.Visibility>
                        </StackPanel>

                        <!-- Hotkey Settings -->
                        <StackPanel Margin="0,5" Visibility="{Binding IsHotkeyItem, Converter={StaticResource BoolToVisibilityConverter}}">
                            <StackPanel Orientation="Horizontal" Margin="0,2">
                                <TextBlock Text="Ctrl:" Width="120" VerticalAlignment="Center" Foreground="Black"/>
                                <CheckBox IsChecked="{Binding CtrlKey, UpdateSourceTrigger=PropertyChanged}" Foreground="Black"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,2">
                                <TextBlock Text="Shift:" Width="120" VerticalAlignment="Center" Foreground="Black"/>
                                <CheckBox IsChecked="{Binding ShiftKey, UpdateSourceTrigger=PropertyChanged}" Foreground="Black"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,2">
                                <TextBlock Text="Alt:" Width="120" VerticalAlignment="Center" Foreground="Black"/>
                                <CheckBox IsChecked="{Binding AltKey, UpdateSourceTrigger=PropertyChanged}" Foreground="Black"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,2">
                                <TextBlock Text="キー:" Width="120" VerticalAlignment="Center" Foreground="Black"/>
                                <ComboBox ItemsSource="{Binding KeyList}" 
                                          SelectedItem="{Binding SelectedKey}" Width="120"
                                          Foreground="Black" Background="White"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Wait Settings -->
                        <StackPanel Margin="0,5" Visibility="{Binding IsWaitItem, Converter={StaticResource BoolToVisibilityConverter}}">
                            <StackPanel Orientation="Horizontal" Margin="0,2">
                                <TextBlock Text="待機時間:" Width="120" Foreground="Black"/>
                                <TextBox Text="{Binding WaitHours, UpdateSourceTrigger=PropertyChanged}" 
                                         Width="30" VerticalAlignment="Center"
                                         Foreground="Black" Background="White"/>
                                <TextBlock Text="時間" Margin="5,0" VerticalAlignment="Center" Foreground="Black"/>
                                <TextBox Text="{Binding WaitMinutes, UpdateSourceTrigger=PropertyChanged}" 
                                         Width="30" VerticalAlignment="Center"
                                         Foreground="Black" Background="White"/>
                                <TextBlock Text="分" Margin="5,0" VerticalAlignment="Center" Foreground="Black"/>
                                <TextBox Text="{Binding WaitSeconds, UpdateSourceTrigger=PropertyChanged}" 
                                         Width="30" VerticalAlignment="Center"
                                         Foreground="Black" Background="White"/>
                                <TextBlock Text="秒" Margin="5,0" VerticalAlignment="Center" Foreground="Black"/>
                                <TextBox Text="{Binding WaitMilliseconds, UpdateSourceTrigger=PropertyChanged}" 
                                         Width="50" VerticalAlignment="Center"
                                         Foreground="Black" Background="White"/>
                                <TextBlock Text="ms" Margin="5,0" VerticalAlignment="Center" Foreground="Black"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Loop Settings -->
                        <StackPanel Orientation="Horizontal" Margin="0,5" 
                                    Visibility="{Binding IsLoopItem, Converter={StaticResource BoolToVisibilityConverter}}">
                            <TextBlock Text="ループ回数:" Width="120" VerticalAlignment="Center" Foreground="Black"/>
                            <TextBox Text="{Binding LoopCount, UpdateSourceTrigger=PropertyChanged}" Width="100"
                                     Foreground="Black" Background="White"/>
                        </StackPanel>

                        <!-- Variable Settings -->
                        <StackPanel Margin="0,5" Visibility="{Binding IsVariableItem, Converter={StaticResource BoolToVisibilityConverter}}">
                            <StackPanel Orientation="Horizontal" Margin="0,2">
                                <TextBlock Text="変数名:" Width="120" VerticalAlignment="Center" Foreground="Black"/>
                                <TextBox Text="{Binding VariableName, UpdateSourceTrigger=PropertyChanged}" Width="200"
                                         Foreground="Black" Background="White"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,2" 
                                        Visibility="{Binding IsSetVariableItem, Converter={StaticResource BoolToVisibilityConverter}}">
                                <TextBlock Text="変数値:" Width="120" VerticalAlignment="Center" Foreground="Black"/>
                                <TextBox Text="{Binding VariableValue, UpdateSourceTrigger=PropertyChanged}" Width="200"
                                         Foreground="Black" Background="White"/>
                            </StackPanel>
                            <StackPanel Visibility="{Binding IsIfVariableItem, Converter={StaticResource BoolToVisibilityConverter}}">
                                <StackPanel Orientation="Horizontal" Margin="0,2">
                                    <TextBlock Text="演算子:" Width="120" VerticalAlignment="Center" Foreground="Black"/>
                                    <ComboBox ItemsSource="{Binding Operators}" 
                                              SelectedValue="{Binding VariableOperator}" 
                                              SelectedValuePath="Key"
                                              DisplayMemberPath="DisplayName"
                                              Width="120" Foreground="Black" Background="White"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,2">
                                    <TextBlock Text="比較値:" Width="120" VerticalAlignment="Center" Foreground="Black"/>
                                    <TextBox Text="{Binding VariableValue, UpdateSourceTrigger=PropertyChanged}" Width="200"
                                             Foreground="Black" Background="White"/>
                                </StackPanel>
                            </StackPanel>
                        </StackPanel>

                        <!-- Execute Program Settings -->
                        <StackPanel Margin="0,5" Visibility="{Binding IsExecuteItem, Converter={StaticResource BoolToVisibilityConverter}}">
                            <StackPanel Orientation="Horizontal" Margin="0,2">
                                <TextBlock Text="プログラムパス:" Width="120" VerticalAlignment="Center" Foreground="Black"/>
                                <TextBox Text="{Binding ProgramPath, UpdateSourceTrigger=PropertyChanged}" IsReadOnly="True" Width="150"
                                         Foreground="Black" Background="White"/>
                                <Button Content="参照" Command="{Binding BrowseProgramFileCommand}" Margin="5,0" Width="40"
                                        Foreground="Black" Background="#F0F0F0"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,2">
                                <TextBlock Text="引数:" Width="120" VerticalAlignment="Center" Foreground="Black"/>
                                <TextBox Text="{Binding Arguments, UpdateSourceTrigger=PropertyChanged}" Width="200"
                                         Foreground="Black" Background="White"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,2">
                                <TextBlock Text="作業フォルダ:" Width="120" VerticalAlignment="Center" Foreground="Black"/>
                                <TextBox Text="{Binding WorkingDirectory, UpdateSourceTrigger=PropertyChanged}" IsReadOnly="True" Width="150"
                                         Foreground="Black" Background="White"/>
                                <Button Content="参照" Command="{Binding BrowseWorkingDirectoryCommand}" Margin="5,0" Width="40"
                                        Foreground="Black" Background="#F0F0F0"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,2">
                                <TextBlock Text="終了まで待機:" Width="120" VerticalAlignment="Center" Foreground="Black"/>
                                <CheckBox IsChecked="{Binding WaitForExit, UpdateSourceTrigger=PropertyChanged}" Foreground="Black"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Screenshot Settings -->
                        <StackPanel Orientation="Horizontal" Margin="0,5" 
                                    Visibility="{Binding IsScreenshotItem, Converter={StaticResource BoolToVisibilityConverter}}">
                            <TextBlock Text="保存先フォルダ:" Width="120" VerticalAlignment="Center" Foreground="Black"/>
                            <TextBox Text="{Binding SaveDirectory, UpdateSourceTrigger=PropertyChanged}" IsReadOnly="True" Width="150"
                                     Foreground="Black" Background="White"/>
                            <Button Content="参照" Command="{Binding BrowseSaveDirectoryCommand}" Margin="5,0" Width="40"
                                    Foreground="Black" Background="#F0F0F0"/>
                        </StackPanel>

                        <!-- Timeout and Interval Settings -->
                        <StackPanel Margin="0,5">
                            <StackPanel Orientation="Horizontal" Margin="0,2">
                                <TextBlock Text="タイムアウト:" Width="120" VerticalAlignment="Center" Foreground="Black"/>
                                <TextBox Text="{Binding Timeout, UpdateSourceTrigger=PropertyChanged}" Width="80"
                                         Foreground="Black" Background="White"/>
                                <TextBlock Text="ms" Margin="5,0" VerticalAlignment="Center" Foreground="Black"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,2">
                                <TextBlock Text="実行間隔:" Width="120" VerticalAlignment="Center" Foreground="Black"/>
                                <TextBox Text="{Binding Interval, UpdateSourceTrigger=PropertyChanged}" Width="80"
                                         Foreground="Black" Background="White"/>
                                <TextBlock Text="ms" Margin="5,0" VerticalAlignment="Center" Foreground="Black"/>
                            </StackPanel>
                            <StackPanel.Visibility>
                                <MultiBinding Converter="{StaticResource MultiBoolToVisibilityConverter}">
                                    <Binding Path="IsWaitImageItem"/>
                                    <Binding Path="IsClickImageItem"/>
                                </MultiBinding>
                            </StackPanel.Visibility>
                        </StackPanel>

                        <!-- AI Detect Mode Settings -->
                        <StackPanel Orientation="Horizontal" Margin="0,5" 
                                    Visibility="{Binding IsSetVariableAIItem, Converter={StaticResource BoolToVisibilityConverter}}">
                            <TextBlock Text="AI検出モード:" Width="120" VerticalAlignment="Center" Foreground="Black"/>
                            <ComboBox ItemsSource="{Binding AiDetectModes}" 
                                      SelectedValue="{Binding AiDetectMode}" 
                                      SelectedValuePath="Key"
                                      DisplayMemberPath="DisplayName"
                                      Width="120" Foreground="Black" Background="White"/>
                        </StackPanel>

                        <!-- Comment Settings (for all commands) -->
                        <StackPanel Margin="0,10" Visibility="{Binding ShowAdvancedSettings, Converter={StaticResource BoolToVisibilityConverter}}">
                            <TextBlock Text="コメント:" Margin="0,0,0,5" Foreground="Black"/>
                            <TextBox Text="{Binding Comment, UpdateSourceTrigger=PropertyChanged}" 
                                     Height="60" TextWrapping="Wrap" AcceptsReturn="True"
                                     VerticalScrollBarVisibility="Auto"
                                     Foreground="Black" Background="White"/>
                        </StackPanel>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </Border>
    </Grid>
</UserControl>